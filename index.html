<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Learning App Android by salesforce-marketingcloud</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Learning App Android</h1>
      <h2 class="project-tagline">Mobile Engagement SDK App built to demonstrate and teach developers to use the SDK</h2>
      <a href="https://github.com/salesforce-marketingcloud/LearningAppAndroid" class="btn">View on GitHub</a>
      <a href="https://github.com/salesforce-marketingcloud/LearningAppAndroid/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/salesforce-marketingcloud/LearningAppAndroid/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><img src="https://raw.githubusercontent.com/salesforce-marketingcloud/LearningAppAndroid/master/imgReadMe/marketing_cloud_logo.png" alt="Marketing Cloud"></p>

<h1>
<a id="readme" class="anchor" href="#readme" aria-hidden="true"><span class="octicon octicon-link"></span></a>README</h1>

<ol>
<li>
<p><a href="#0001">About</a></p>

<ol>
<li><p><a href="#0002">Marketing Cloud App Center</a></p></li>
<li><p><a href="#0003">Push Notifications</a></p></li>
<li><p><a href="#0004">Subscriber key</a></p></li>
<li><p><a href="#0005">Tags</a></p></li>
<li><p><a href="#0006">Beacon and Geofence Messages</a></p></li>
<li><p><a href="#0006b">Analytics</a></p></li>
</ol>
</li>
<li>
<p><a href="#0007">Implementation on Android</a></p>

<ol>
<li>
<p><a href="#0008">Previous steps</a></p>

<ol>
<li><p><a href="#0009">Provision Apps with Google</a></p></li>
<li>
<p><a href="#0010">Create your apps in the App Center</a></p>

<ol>
<li><p><a href="#0011">Add app to App Center</a></p></li>
<li><p><a href="#0012">Integrate App Center app</a></p></li>
</ol>
</li>
</ol>
</li>
<li><p><a href="#0013">Setting up the SDK</a></p></li>
<li><p><a href="#0014">Implementing the SDK Push Notifications</a></p></li>
<li><p><a href="#0015">Subscriber Key Implementation</a></p></li>
<li><p><a href="#0016">Tag Implementation</a></p></li>
<li><p><a href="#0017">Beacon and Geofence Messages Implementation</a></p></li>
<li><p><a href="#0018">Implement Analytics in your Mobile App</a></p></li>
</ol>
</li>
</ol>

<p><a name="0001"></a></p>

<h1>
<a id="about" class="anchor" href="#about" aria-hidden="true"><span class="octicon octicon-link"></span></a>About</h1>

<p>This project provides a template for creating a mobile app (Android or iOS) that uses the Journey Builder for Apps SDK.  It is also a UI for exploring its features and provides a mechanism to collect and send debugging information to learn about the workings of the SDK as you explore.</p>

<p>The code in this repository includes all of the code used to run the fully functional APK including an App ID and Access Token to let you test and debug the application. These keys will trigger an hourly automated push message of a timestamp, indicating that the application is properly setup. To create a new app the following keys must be set with your own values within the corresponding file.</p>

<p><strong>secrets.xml</strong></p>

<ol>
<li><p><code>app_id</code>: the App ID for your development app as defined in the App Center section of the Marketing Cloud.</p></li>
<li><p><code>gcm_sender_id</code>: the Google Cloud Messaging ID as defined in the Google Cloud Developers Console for your app.</p></li>
<li><p><code>access_token</code>: the Access Token for your development app as defined in the App Center section of the Marketing Cloud.</p></li>
</ol>

<p>NB: You can use different keys for the staging/testing phase and the production phase.  Staging/testing keys are indicated by the prefix <code>staging_</code>.</p>

<p><a name="0002"></a></p>

<h2>
<a id="marketing-cloud-app-center" class="anchor" href="#marketing-cloud-app-center" aria-hidden="true"><span class="octicon octicon-link"></span></a>Marketing Cloud App Center</h2>

<p>App Center is the central development console for using Fuel’s APIs and building Marketing Cloud apps.</p>

<p>In order to connect your app to the Marketing Cloud, you must first create a MobilePush app in the App Center. </p>

<p>Each app in App Center represents an application connected to the Marketing Cloud. App Center currently manages four types of connected apps:</p>

<ul>
<li><p><em>API Integration</em> allows you to leverage the Marketing Cloud APIs. Create an API Integration app when you want to use Fuel APIs to automate tasks or integrate business systems. API Integration apps utilize an OAuth2 client credentials flow to acquire access tokens directly from the Fuel authentication service.</p></li>
<li><p><em>Marketing Cloud apps</em> represent apps that live within the Salesforce Marketing Cloud and launch via the Marketing Cloud app menu. Marketing Cloud apps include custom apps built by your organization or apps installed from the Salesforce Marketing Cloud HubExchange. Marketing Cloud apps utilize a JSON Web Token (JWT) to acquire access tokens on behalf of logged in users.</p></li>
<li><p><em>Application Extensions</em> allow you to extend the Marketing Cloud with custom Journey Builder activities, Cloud Editor Blocks, and Automation Studio activities.</p></li>
<li><p><em>MobilePush apps</em> represent apps built for the iOS, Android, or Blackberry mobile platforms that use MobilePush to communicate with their users via push messages. The Salesforce Marketing Cloud classifies MobilePush apps as consumer-grade applications and utilize long-lived limited access tokens.</p></li>
</ul>

<p>If you haven’t already, you should <a href="https://appcenter-auth.exacttargetapps.com/create">create an App Center account</a>.</p>

<p>If you have an App Center account, you can <a href="https://appcenter-auth.exacttargetapps.com/redirect">log in to that account</a>.
<a name="0003"></a></p>

<h2>
<a id="push-notifications" class="anchor" href="#push-notifications" aria-hidden="true"><span class="octicon octicon-link"></span></a>Push Notifications</h2>

<p>MobilePush lets you create and send targeted push messages based on cross-channel consumer data to encourage app usage and deliver increased ROI.  With MobilePush, you view how users navigate through your app and because MobilePush is built on the Salesforce Marketing Cloud, you can easily integrate push message campaigns with any email, SMS, or social campaigns.
<a name="0004"></a></p>

<h2>
<a id="subscriber-key" class="anchor" href="#subscriber-key" aria-hidden="true"><span class="octicon octicon-link"></span></a>Subscriber key</h2>

<p>A subscriber is a person who has opted to receive communications from your organization. </p>

<p>A valid email address is required to receive emails and a phone number to receive SMS messages.  Additional information about subscribers can be tracked using profile and preference attributes.</p>

<p>The Subscriber Key serves to identify your subscribers.</p>

<p>It can be set to a specific value provided by the subscriber such as a phone number, email address, or other appropriate value but most importantly a value that you choose.</p>

<p>For example, using a subscriber key to identify a subscriber with a value other than the email address would allow you to:</p>

<ul>
<li><p>Maintain multiple sets of subscriber attributes for a single email address. For example, if a family shares an email address, you can use a subscriber key to uniquely identify each member of the family.</p></li>
<li><p>Include a single email address multiple times on a list. For example, if a message interaction sends a separate message for each car a subscriber owns, it may be appropriate for a single subscriber to receive multiple messages.</p></li>
</ul>

<p>The Salesforce Marketing Cloud interface as well as the Web Service SOAP API support functionality around subscribers identified with a subscriber key.
<a name="0005"></a></p>

<h2>
<a id="tags" class="anchor" href="#tags" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tags</h2>

<p>Tags let you implement contact segmentation. You can set tags for subscriptions as defined by user choice.  Additionally, use tags to collect information from the mobile app and for unstructured data or data that can contain many potential unknown values. For example, you can use tags when the number of potential attribute names exceeds the number of potential values of an individual attribute (such as the favorite brand specified by a contact).
<a name="0006"></a></p>

<h2>
<a id="beacon-and-geofence-messages" class="anchor" href="#beacon-and-geofence-messages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Beacon and Geofence Messages</h2>

<p>You can use the location capabilities of the <em>JB4A SDK</em> to target messages to a segmented group of contacts.  Send personalized messages to increase engagement.  The app pre-downloads geofence messages and triggers those messages when a mobile device crosses a geofence boundary.  To use this functionality:</p>

<ol>
<li><p>The account must have access to both MobilePush and Location Services.</p></li>
<li><p>Ensure that you use version 7.8.0 or earlier of Google Play Services to enable geolocation for your app.</p></li>
<li><p>You must receive user permission to implement location services.</p></li>
</ol>

<p><a name="0006b"></a></p>

<h2>
<a id="analytics" class="anchor" href="#analytics" aria-hidden="true"><span class="octicon octicon-link"></span></a>Analytics</h2>

<p>Mobile Application Analytics enables marketers to gather mobile app actions and behaviors from users and provides powerful visualizations of the data. The data helps you make informative decisions about how to structure your customer journeys, design your client facing experiences and tailor your digital marketing campaigns. The collected data is also available inside the Salesforce Marketing Cloud – ready to be used to segment messaging lists, provide highly personalized messaging content and drive 1:1  Custom Journeys.</p>

<p>After enabling the analytics feature in your app, visit the Web &amp; Mobile Analytics application within the Marketing Cloud.</p>

<p><a name="0007"></a></p>

<h1>
<a id="implementation-on-android" class="anchor" href="#implementation-on-android" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implementation on Android</h1>

<p><a name="0008"></a></p>

<h2>
<a id="previous-steps" class="anchor" href="#previous-steps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Previous steps</h2>

<ol>
<li><p>Provision Apps with Google  </p></li>
<li><p>Create your apps in the App Center</p></li>
</ol>

<p><a name="0009"></a></p>

<h3>
<a id="provision-apps-with-google" class="anchor" href="#provision-apps-with-google" aria-hidden="true"><span class="octicon octicon-link"></span></a>Provision Apps with Google</h3>

<p>These steps are key to receiving push messages in your app.</p>

<p>Review the Android documentation regarding the integration of your Android mobile app with Google Cloud Messaging found in <a href="https://developer.android.com/google/gcm/http.html">Google Cloud Messaging (GCM) HTTP connection server.</a></p>

<ol>
<li>
<p>Log into the <a href="https://console.developers.google.com/">Google Developers Console</a> and click <strong>Create a project...</strong>.</p>

<ol>
<li><p>Enter a name for your project in the <strong>PROJECT NAME</strong> field.</p></li>
<li><p>Use the suggested default ID for your project or click in <strong>Edit</strong> to enter a custom one.</p></li>
<li><p>Click Create.</p></li>
</ol>
</li>
<li>
<p>Record the Project Number value supplied by the Google Cloud Console. You will use this value later in your Android application code as the <strong>Google Cloud Messaging Sender ID</strong>.</p>

<p><img src="imgReadMe/image_00.png" alt="image alt text"></p>
</li>
<li><p>In the the left menu click on <strong>APIs</strong> (<strong>APIs &amp; auth</strong> section).</p></li>
<li>
<p>Enable <strong>Google Cloud Messaging for Android</strong> by clicking Google Cloud Messaging For Android:</p>

<p><img src="imgReadMe/image_01.png" alt="image alt text"></p>
</li>
<li>
<p>Click the button that says "Enable API".</p>

<p><img src="imgReadMe/image_02.png" alt="image alt text"></p>
</li>
<li><p>Click <strong>Credentials</strong> in the left menu.</p></li>
<li>
<p>Click <strong>Add credentials</strong> → <strong>API key</strong>, and select <strong>Android key</strong> in the dialog.</p>

<p><img src="imgReadMe/image_03.png" alt="image alt text"></p>

<p><img src="imgReadMe/image_04.png" alt="image alt text"></p>
</li>
<li>
<p>Retrieve the <strong>SHA1 Certificate Fingerprint</strong> of the Android Debug Key from a (Unix/Mac) Terminal or (Windows) Command Prompt.  <em>Have each developer on your team complete this step and provide their SHA1 Certificate Fingerprint for inclusion in the</em> <strong><em>allowed Android applications</em></strong> <em>field below</em>. <strong><em>You will also need to add an entry for your production signing key.</em></strong></p>

<p>Unix/Mac: <code>keytool -exportcert -alias androiddebugkey -keystore ~/.android/debug.keystore -list -v</code></p>

<p>Windows: <code>keytool -alias androiddebugkey -keystore %USERPROFILE%\.android\debug.keystore -list -v</code></p>

<p><img src="imgReadMe/image_05.jpg" alt="image alt text"></p>

<p><img src="imgReadMe/image_06.jpg" alt="image alt text"> </p>
</li>
<li>
<p>Enter a name for your key, and click in <strong>Add package name and fingerprint</strong>. Enter your package name (must match the package name you will use in your Android project) and paste each developer’s <strong>SHA1 Certificate Fingerprint</strong> separated by a semicolon in the corresponding fields, and then click <strong>Create</strong>.</p>

<p><img src="imgReadMe/image_07.png" alt="image alt text"></p>
</li>
<li>
<p>Click <strong>Ok</strong> in the dialog.</p>

<p><img src="imgReadMe/image_08.png" alt="image alt text"></p>
</li>
<li><p>Now create a new Server key by repeating step 7 but choosing <strong>Server key</strong>.</p></li>
<li>
<p>Enter a name for the key. You can enter server IP address to filter request or leave this entry blank.</p>

<p><em>Important: Leaving this entry blank will simplify development but is not secure. When you have verified that you have things setup correctly you should restrict access by providing individual server IP addresses or, at least, restrict the range to your known address ranges.</em></p>

<p><img src="imgReadMe/image_09.png" alt="image alt text"></p>
</li>
<li><p>Click <strong>Create</strong> and copy the <strong>API KEY</strong> value from the <strong>Server application</strong>.</p></li>
<li><p>Use the API Key from the server application created above to add to your MobilePush app in the <em>Create your apps in the App Center</em> step. And use the project number to set the <code>gcm_sender_id</code> in your project.</p></li>
</ol>

<p><a name="0010"></a></p>

<h3>
<a id="create-your-apps-in-the-app-center" class="anchor" href="#create-your-apps-in-the-app-center" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create your apps in the App Center</h3>

<p>In order to connect your app to your Marketing Cloud account, you must follow these steps:</p>

<ol>
<li><p>Add app to App Center.</p></li>
<li><p>Integrate the App Center app to your Marketing Cloud account.</p></li>
<li><p>Add the Provisioning info created in the GCM Console to the app in the App Center.</p></li>
</ol>

<p><a name="0011"></a></p>

<h4>
<a id="add-app-to-app-center" class="anchor" href="#add-app-to-app-center" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add app to App Center</h4>

<p>To create a new MobilePush app:</p>

<ol>
<li><p><a href="https://appcenter-auth.exacttargetapps.com/redirect">Log in to the App Center</a> (<a href="https://appcenter-auth.exacttargetapps.com/create">create an account</a> if necessary).</p></li>
<li>
<p>Create a new app and select the MobilePush template.</p>

<p><img src="imgReadMe/image_10.png" alt="image alt text"></p>
</li>
<li>
<p>Fill in, at a minimum, the mandatory fields in this form.</p>

<p><img src="imgReadMe/image_11.png" alt="image alt text"></p>

<p><em>Depending on your setup, repeat this process if you plan on using different instances for production and development.</em></p>

<p>Note the following about the required fields:</p>

<ol>
<li><p>The <strong>Name</strong> can be anything you choose.</p></li>
<li><p>The <strong>Package</strong> has no correlation to anything outside of the MarketingCloud ecosystem and can be <strong>any</strong> unique identifier for your application.</p></li>
<li><p>The <strong>Description</strong> &amp; <strong>MobilePush Icon</strong> fields are optional but will help you identify your application within your Marketing Cloud account. </p></li>
</ol>
</li>
<li><p>Click <strong>Next</strong> in order to integrate this new app with your Marketing Cloud account.</p></li>
</ol>

<p><a name="0012"></a></p>

<h4>
<a id="integrate-app-center-app" class="anchor" href="#integrate-app-center-app" aria-hidden="true"><span class="octicon octicon-link"></span></a>Integrate App Center app</h4>

<p>The MobilePush app created in the App Center must be connected to a specific Marketing Cloud account. You must have a login for your Marketing Cloud account in order to connect this MobilePush app to the correct Marketing Cloud account.</p>

<p>Follow these steps in order to connect this MobilePush app to the correct Marketing Cloud account:</p>

<ol>
<li>
<p>Select an account (or New…) in the <strong>Account</strong> drop-down.</p>

<p><img src="imgReadMe/image_12.png" alt="image alt text"></p>
</li>
<li><p>Select the <strong>Production ExactTarget Account</strong> button <em>unless otherwise instructed by your Salesforce Marketing Cloud relationship manager.</em></p></li>
<li>
<p>Click <strong>Link to Account</strong>.</p>

<p>A popup window (pictured below) will appear.</p>

<p><img src="imgReadMe/image_13.png" alt="image alt text"></p>
</li>
<li><p>In an Enterprise 2.0 account, ensure that you select the correct business unit for your app integration.</p></li>
<li><p>Click <strong>Integrate</strong>.</p></li>
<li>
<p>In the GCM Client section, enter the server API KEY previously created in the <a href="#0009">Provision Apps with Google</a> step (you can get this key by entering in the <a href="https://console.developers.google.com/">Google Cloud Console</a>).</p>

<p><img src="imgReadMe/image_14.png" alt="image alt text"></p>
</li>
<li><p>When you have all the fields required for your application’s platform(s) populated, click <em>Next</em>.</p></li>
<li>
<p>Review the information you provided and check for any potential errors and click <strong>Finish</strong>.</p>

<p>You should be presented with a <em>Success!</em> message and an application details screen. Any of the areas can be edited by clicking the edit icon associated with the <strong>Summary</strong> or <strong>Application Provisioning</strong> sections.</p>

<p><img src="imgReadMe/image_15.png" alt="image alt text"></p>
</li>
</ol>

<p>Record the <strong>Application ID</strong> and the <strong>Access Token</strong> as they will be used later in the secrets.xml file.</p>

<p><a name="0013"></a></p>

<h2>
<a id="setting-up-the-sdk" class="anchor" href="#setting-up-the-sdk" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting up the SDK</h2>

<p>The <code>readyAimFire</code> method of the ETPush class configures the SDK to point to the correct code application.</p>

<p>Call this from your Application's Application.onCreate() method. This initializes ETPush.</p>

<p>When ReadyAimFire() is called for the first time for a device, it will get a device token
from Google and send to the MarketingCloud.</p>

<p>In ETPush.readyAimFire() you must set several parameters:</p>

<ul>
<li><p><code>app_id</code> and <code>access_token</code>: these values are taken from the Marketing Cloud definition for your app.</p></li>
<li><p><code>gcm_sender_id</code> for the push notifications: this value is taken from the Google API console.</p></li>
<li><p>You can also set whether you enable location manager, cloud pages, and analytics.</p></li>
</ul>

<p>To set the logging level, call ETPush.setLogLevel().</p>

<p><a name="0014"></a></p>

<h2>
<a id="push-notifications-1" class="anchor" href="#push-notifications-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Push Notifications</h2>

<p>Update the following files in your project:</p>

<ol>
<li>secrets.xml</li>
<li>AndroidManifest.xml</li>
<li>build.gradle</li>
<li>app/build.gradle</li>
<li>ApplicationClass.java</li>
</ol>

<p><strong>Secrets.xml</strong></p>

<p>The SDK can now be configured with the App ID and Access Token, as explained in the <em>About</em> section.  Update <code>app_id</code> and <code>access_token</code> with their respective values.</p>

<p><strong>AndroidManifest.xml</strong></p>

<p>In this file declare the following permissions:</p>

<p><em>JB4A SDK Google Permissions</em> - These permissions are required to receive push messages which use the Google Cloud Messaging service.</p>

<p><a href="/app/src/main/AndroidManifest.xml#L5-L12">view the code</a></p>

<div class="highlight highlight-text-xml"><pre><span class="pl-c">&lt;!-- JB4A SDK Google Permissions --&gt;</span>
&lt;<span class="pl-ent">permission</span> 
    <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>${applicationId}.permission.C2D_MESSAGE<span class="pl-pds">"</span></span>
    <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">protectionLevel</span>=<span class="pl-s"><span class="pl-pds">"</span>signature<span class="pl-pds">"</span></span> /&gt;

&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>${applicationId}.permission.C2D_MESSAGE<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.google.android.c2dm.permission.RECEIVE<span class="pl-pds">"</span></span> /&gt;
<span class="pl-c">&lt;!-- END JB4A SDK Google Permissions --&gt;</span></pre></div>

<p><em>JB4A SDK required permissions</em> - These permissions are necessary for the SDK to function.  The first three permissions establish internet connection status for the application to synchronize with Marketing Cloud. The WAKE_LOCK permission allows PowerManager WakeLocks to keep the processor from sleeping or screen from dimming.</p>

<p><a href="/app/src/main/AndroidManifest.xml#L15-L20">view the code</a></p>

<div class="highlight highlight-text-xml"><pre><span class="pl-c">&lt;!-- JB4A SDK required permissions --&gt;</span>
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.INTERNET<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_NETWORK_STATE<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_WIFI_STATE<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.WAKE_LOCK<span class="pl-pds">"</span></span> /&gt;
<span class="pl-c">&lt;!-- END JB4A SDK required permissions --&gt;</span></pre></div>

<p>In the activity section, make sure to include the ETPushReceiver and Service for the push notifications.</p>

<p><a href="/app/src/main/AndroidManifest.xml#L56-L84">view the code</a></p>

<div class="highlight highlight-text-xml"><pre><span class="pl-c">&lt;!-- ETPushReceiver and Service --&gt;</span>
&lt;<span class="pl-ent">receiver</span>
    <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.exacttarget.etpushsdk.ETPushReceiver<span class="pl-pds">"</span></span>
    <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">permission</span>=<span class="pl-s"><span class="pl-pds">"</span>com.google.android.c2dm.permission.SEND<span class="pl-pds">"</span></span> &gt;

   &lt;<span class="pl-ent">intent-filter</span>&gt;
       &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>${applicationId}.MESSAGE_OPENED<span class="pl-pds">"</span></span> /&gt;
       &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.exacttarget.etpushsdk.SEND_REGISTRATION<span class="pl-pds">"</span></span> /&gt;
       &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.google.android.c2dm.intent.RECEIVE<span class="pl-pds">"</span></span> /&gt;
       &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.google.android.c2dm.intent.REGISTRATION<span class="pl-pds">"</span></span> /&gt;
       &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.intent.action.ACTION_SHUTDOWN<span class="pl-pds">"</span></span> /&gt;
       &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.intent.action.AIRPLANE_MODE<span class="pl-pds">"</span></span> /&gt;
       &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.intent.action.BATTERY_LOW<span class="pl-pds">"</span></span> /&gt;
       &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.intent.action.BATTERY_OKAY<span class="pl-pds">"</span></span> /&gt;
       &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.intent.action.BOOT_COMPLETED<span class="pl-pds">"</span></span> /&gt;
       &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.net.conn.CONNECTIVITY_CHANGE<span class="pl-pds">"</span></span> /&gt;
       &lt;<span class="pl-ent">category</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>${applicationId}<span class="pl-pds">"</span></span> /&gt;
   &lt;/<span class="pl-ent">intent-filter</span>&gt;

   &lt;<span class="pl-ent">intent-filter</span>&gt;
       &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.intent.action.PACKAGE_REPLACED<span class="pl-pds">"</span></span> /&gt;
       &lt;<span class="pl-ent">data</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">scheme</span>=<span class="pl-s"><span class="pl-pds">"</span>package<span class="pl-pds">"</span></span> /&gt;
   &lt;/<span class="pl-ent">intent-filter</span>&gt;
&lt;/<span class="pl-ent">receiver</span>&gt;

&lt;<span class="pl-ent">service</span>
    <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.exacttarget.etpushsdk.ETPushService<span class="pl-pds">"</span></span>
    <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">enabled</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> /&gt;

<span class="pl-c">&lt;!-- END ETPushReceiver and Service --&gt;</span></pre></div>

<p><strong>build.gradle</strong></p>

<p>Add the following repository:</p>

<p><a href="/build.gradle#L18-L26">view the code</a></p>

<div class="highlight highlight-source-groovy-gradle"><pre><span class="pl-en">allprojects</span> {
    repositories {
        jcenter()
        mavenCentral()
        maven {
            url <span class="pl-s"><span class="pl-pds">"</span>http://salesforce-marketingcloud.github.io/JB4A-SDK-Android/repository<span class="pl-pds">"</span></span>
        }
    }
}</pre></div>

<p><strong>app/build.gradle</strong></p>

<p>Include the following dependencies in your application's app/build.gradle file:</p>

<p><a href="/app/build.gradle#L33-L48">view the code</a></p>

<div class="highlight highlight-source-groovy-gradle"><pre><span class="pl-en">dependencies</span> {
    <span class="pl-c">/* Google's Support v4 for Notification compatibility */</span>
    compile <span class="pl-s"><span class="pl-pds">'</span>com.android.support:appcompat-v7:23.1.0<span class="pl-pds">'</span></span>
    compile <span class="pl-s"><span class="pl-pds">'</span>com.android.support:support-v4:23.1.0<span class="pl-pds">'</span></span>
    compile <span class="pl-s"><span class="pl-pds">'</span>com.android.support:design:23.1.0<span class="pl-pds">'</span></span>

    <span class="pl-c">/* SDK */</span>
    compile <span class="pl-s"><span class="pl-pds">'</span>com.exacttarget.etpushsdk:etsdk:4.0.6@aar<span class="pl-pds">'</span></span>

    <span class="pl-c">/* Google Play Services for Location and Google Cloud Messaging */</span>
    compile <span class="pl-s"><span class="pl-pds">'</span>com.google.android.gms:play-services-location:7.8.0<span class="pl-pds">'</span></span>
    compile <span class="pl-s"><span class="pl-pds">'</span>com.google.android.gms:play-services-gcm:7.8.0<span class="pl-pds">'</span></span>

    <span class="pl-c">/* 3rd Party Libraries Required for SDK integration */</span>
    compile <span class="pl-s"><span class="pl-pds">'</span>com.radiusnetworks:AndroidIBeaconLibrary:0.7.6<span class="pl-pds">'</span></span>
}</pre></div>

<p><strong>ApplicationClass.java</strong></p>

<p>The boolean parameters <code>ANALYTICS_ENABLED</code>, <code>CLOUD_PAGES_ENABLED</code>, <code>WAMA_ENABLED</code>, <code>LOCATION_ENABLED</code> and <code>PROXIMITY_ENABLED</code> enable certain functionalities of the SDK, however, they are not required for the push notifications themselves to function which will still be sent even if all are set to false.</p>

<p><a name="0014"></a></p>

<h2>
<a id="subscriber-key-implementation" class="anchor" href="#subscriber-key-implementation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Subscriber Key Implementation</h2>

<ol>
<li><p>Create a new activity called <code>SettingsActivity</code> that extends <code>PreferenceActivity</code> in your project.</p></li>
<li><p>Create a new fragment called <code>SettingsFragment</code> that extends <code>PreferenceFragment</code>.</p></li>
<li>
<p>Now create an instance of the SettingsFragment in the SettingsActivity class, add the following code to the <code>onCreate()</code> method:</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/SettingsActivity.java#L37-L38">view the code</a></p>

<div class="highlight highlight-source-java"><pre>getFragmentManager()<span class="pl-k">.</span>beginTransaction()<span class="pl-k">.</span>replace(<span class="pl-smi">android<span class="pl-k">.</span>R</span><span class="pl-k">.</span>id<span class="pl-k">.</span>content, <span class="pl-k">new</span> <span class="pl-smi">SettingsFragment</span>())<span class="pl-k">.</span>commit();</pre></div>
</li>
<li><p>Create a new file called <a href="app/src/main/res/xml/preferences.xml">preferences.xml</a> in res/xml that will be the settings view.</p></li>
<li><p>Reference the preferences.xml file in the <code>onCreate()</code> method in the SettingsFragment class with the following code: <code>addPreferencesFromResource(R.xml.preferences);</code></p></li>
<li>
<p>Add a private attribute SharedPreferences sp and set it as the default shared preference:</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/SettingsFragment.java#L50">view the code</a></p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">private</span> <span class="pl-smi">SharedPreferences</span> sp;
…
<span class="pl-v">this</span><span class="pl-k">.</span>sp <span class="pl-k">=</span> getActivity()<span class="pl-k">.</span>getPreferences(<span class="pl-smi">Context</span><span class="pl-c1"><span class="pl-k">.</span>MODE_PRIVATE</span>);</pre></div>
</li>
<li>
<p>Add a private attribute pusher, the instance of ETPush:</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/SettingsFragment.java#L54">view the code</a></p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">private</span> <span class="pl-smi">ETPush</span> pusher;
…
<span class="pl-v">this</span><span class="pl-k">.</span>pusher <span class="pl-k">=</span> <span class="pl-smi">ETPush</span><span class="pl-k">.</span>getInstance();</pre></div>
</li>
<li>
<p>Now create the reference to the EditTextPreference from preferences.xml and set the value stored in settings Preferences. Add an <code>OnPreferenceClickListener()</code> to open a Dialog with input for the user to enter their Subscriber Key.  This value is stored in the settings Preferences and will be passed to the pusher.</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/SettingsFragment.java#L94-L104">view the code</a></p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">SharedPreferences</span><span class="pl-k">.</span><span class="pl-smi">Editor</span> editor <span class="pl-k">=</span> sp<span class="pl-k">.</span>edit();
editor<span class="pl-k">.</span>putString(<span class="pl-c1">KEY_PREF_SUBSCRIBER_KEY</span>, newSubscriberKey);
editor<span class="pl-k">.</span>commit();
…
pusher<span class="pl-k">.</span>setSubscriberKey(newSubscriberKey);</pre></div>
</li>
</ol>

<p>It will take up to 15 minutes for the new value to be recorded in the Contact Record. If an internet connection is not available when the update is made, the SDK will save the update and send it whenever the network becomes available.</p>

<p>By default, if your app does not set the Subscriber Key using <code>setSubscriberKey()</code>, the registration sent will be matched with a Contact Record that matches the System Token included in the registration payload. If no match is found, then a new Subscriber Key will be set in the Marketing Cloud and will not be sent back to the SDK.</p>

<p><a name="0016"></a></p>

<h2>
<a id="tag-implementation" class="anchor" href="#tag-implementation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tag Implementation</h2>

<p>This feature is implemented in Settings Preferences.  We assume that the Subscriber Key feature has been implemented as described in this guide in order for the following steps to work.</p>

<ol>
<li>
<p>Add a Set of tags as a private attribute.</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/SettingsFragment.java#L37">view the code</a></p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">private</span> <span class="pl-k">Set&lt;<span class="pl-smi">String</span>&gt;</span> allTags;</pre></div>
</li>
<li>
<p>For the implementation of this feature, an instance of PreferenceScreen is needed to display the tags dynamically on the screen.</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/SettingsFragment.java#L40">view the code</a></p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">private</span> <span class="pl-smi">PreferenceScreen</span> prefScreen;</pre></div>
</li>
<li>
<p>In the onCreate() method set the values for prefScreen.</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/SettingsFragment.java#L53">view the code</a></p>

<div class="highlight highlight-source-java"><pre><span class="pl-v">this</span><span class="pl-k">.</span>prefScreen <span class="pl-k">=</span> getPreferenceScreen();</pre></div>
</li>
<li>
<p>To display the tags on screen, call these methods inside the onCreate() method:</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/SettingsFragment.java#L59-L60">view the code</a></p>

<div class="highlight highlight-source-java"><pre><span class="pl-v">this</span><span class="pl-k">.</span>allTags <span class="pl-k">=</span> <span class="pl-v">this</span><span class="pl-k">.</span>pusher<span class="pl-k">.</span>getTags() <span class="pl-k">!=</span> <span class="pl-c1">null</span> <span class="pl-k">?</span> <span class="pl-v">this</span><span class="pl-k">.</span>pusher<span class="pl-k">.</span>getTags() <span class="pl-k">:</span> <span class="pl-k">new</span> <span class="pl-k">HashSet&lt;<span class="pl-smi">String</span>&gt;</span>();
storeAllTags(<span class="pl-v">this</span><span class="pl-k">.</span>allTags);</pre></div>

<p>The <code>storeAllTags(Set&lt;String&gt; tags)</code> method saves the tags in Preferences and populates the allTags attribute with all of the stored tags.</p>
</li>
<li>
<p>To display the tags on screen, call these methods inside the onCreate() method:</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/SettingsFragment.java#L115">view the code</a></p>

<div class="highlight highlight-source-java"><pre>configureTags();</pre></div>

<p>The <code>configureTags()</code> method renders the tags section, a clickable EditTextPreference to add a new tag and the tags from allTags with checkboxes to enable/disable the tag.</p>
</li>
</ol>

<p><a name="0017"></a></p>

<h2>
<a id="beacon-and-geofence-messages-implementation" class="anchor" href="#beacon-and-geofence-messages-implementation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Beacon and Geofence Messages Implementation</h2>

<ol>
<li>
<p>In your application’s app/build.gradle file add the following dependence (required for applications that will run on devices with Android OS &lt; 5.0):</p>

<p><a href="/app/build.gradle#L46-L47">view the code</a></p>

<div class="highlight highlight-source-groovy-gradle"><pre><span class="pl-c">/* 3rd Party Libraries Required for SDK integration */</span>
compile <span class="pl-s"><span class="pl-pds">'</span>com.radiusnetworks:AndroidIBeaconLibrary:0.7.6<span class="pl-pds">'</span></span></pre></div>
</li>
<li>
<p>In your AndroidManifest, add the <em>JB4A SDK Permissions for location and region monitoring</em>, and the ETLocation Receiver and Service required to receive the push notifications based on the location of the customer.</p>

<p><a href="/app/src/main/AndroidManifest.xml#L24">view the code</a></p>

<div class="highlight highlight-text-xml"><pre><span class="pl-c">&lt;!-- JB4A SDK Permissions for location and region monitoring --&gt;</span>
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_COARSE_LOCATION<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.ACCESS_FINE_LOCATION<span class="pl-pds">"</span></span> /&gt;
&lt;<span class="pl-ent">uses-permission</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.permission.RECEIVE_BOOT_COMPLETED<span class="pl-pds">"</span></span> /&gt;
<span class="pl-c">&lt;!-- END JB4A SDK location and region monitoring Permissions --&gt;</span>
…

<span class="pl-c">&lt;!-- ETLocationReceiver and Service --&gt;</span>
&lt;<span class="pl-ent">receiver</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.exacttarget.etpushsdk.ETLocationReceiver<span class="pl-pds">"</span></span> &gt;
    &lt;<span class="pl-ent">intent-filter</span>&gt;
        &lt;<span class="pl-ent">action</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.location.PROVIDERS_CHANGED<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">category</span> <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>android.intent.category.DEFAULT<span class="pl-pds">"</span></span> /&gt;
    &lt;/<span class="pl-ent">intent-filter</span>&gt;
&lt;/<span class="pl-ent">receiver</span>&gt;

&lt;<span class="pl-ent">service</span>
    <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>com.exacttarget.etpushsdk.ETLocationService<span class="pl-pds">"</span></span>
    <span class="pl-e">android</span><span class="pl-e">:</span><span class="pl-e">enabled</span>=<span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span> /&gt;
<span class="pl-c">&lt;!-- END ETLocationReceiver and Service --&gt;</span></pre></div>
</li>
<li>
<p>In your ApplicationClass, set the <code>LOCATION_ENABLED</code> parameter to true:</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/ApplicationClass.java#L56">view the code</a></p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-k">boolean</span> <span class="pl-c1">LOCATION_ENABLED</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;</pre></div>
</li>
<li>
<p>In your ApplicationClass, set the <code>PROXIMITY_ENABLED</code> parameter to true:</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/ApplicationClass.java#L52">view the code</a></p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-k">boolean</span> <span class="pl-c1">PROXIMITY_ENABLED</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;</pre></div>
</li>
</ol>

<p><a name="0018"></a></p>

<h2>
<a id="implement-analytics-in-your-mobile-app" class="anchor" href="#implement-analytics-in-your-mobile-app" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implement Analytics in your Mobile App</h2>

<p><strong>ApplicationClass.java</strong></p>

<p>In your ApplicationClass, set the <code>ANALYTICS_ENABLED</code> parameter to true:</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/ApplicationClass.java#L56">view the code</a></p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">final</span> <span class="pl-k">boolean</span> <span class="pl-c1">ANALYTICS_ENABLED</span> <span class="pl-k">=</span> <span class="pl-c1">true</span>;</pre></div>

<p><strong>BaseActivity.java</strong></p>

<p>Your app sends analytics whenever it goes into the background.  Override onPause() and onResume() in each Activity class to notify the SDK when activities pause and resume so the SDK can determine when your app goes into the background.</p>

<p><a href="/app/src/main/java/com/salesforce/kp/wheresreid/BaseActivity.java#L15-L52">view the code</a></p>

<div class="highlight highlight-source-java"><pre>@<span class="pl-smi">Override</span>
<span class="pl-k">protected</span> <span class="pl-k">void</span> onPause() {
   <span class="pl-v">super</span><span class="pl-k">.</span>onPause();
   <span class="pl-k">try</span> {
       <span class="pl-c">// Let JB4A SDK know when each activity paused</span>
       <span class="pl-smi">ETPush</span><span class="pl-k">.</span>activityPaused(<span class="pl-v">this</span>);
   } <span class="pl-k">catch</span> (<span class="pl-smi">Exception</span> e) {
       <span class="pl-k">if</span> (<span class="pl-smi">ETPush</span><span class="pl-k">.</span>getLogLevel() <span class="pl-k">&lt;=</span> <span class="pl-smi">Log</span><span class="pl-c1"><span class="pl-k">.</span>ERROR</span>) {
           <span class="pl-smi">Log</span><span class="pl-k">.</span>e(<span class="pl-c1">TAG</span>, e<span class="pl-k">.</span>getMessage(), e);
       }
   }
}

@<span class="pl-smi">Override</span>
<span class="pl-k">protected</span> <span class="pl-k">void</span> onResume() {
   <span class="pl-v">super</span><span class="pl-k">.</span>onResume();
   <span class="pl-k">try</span> {
       <span class="pl-c">// Let JB4A SDK know when each activity is resumed</span>
       <span class="pl-smi">ETPush</span><span class="pl-k">.</span>activityResumed(<span class="pl-v">this</span>);
   } <span class="pl-k">catch</span> (<span class="pl-smi">Exception</span> e) {
       <span class="pl-k">if</span> (<span class="pl-smi">ETPush</span><span class="pl-k">.</span>getLogLevel() <span class="pl-k">&lt;=</span> <span class="pl-smi">Log</span><span class="pl-c1"><span class="pl-k">.</span>ERROR</span>) {
           <span class="pl-smi">Log</span><span class="pl-k">.</span>e(<span class="pl-c1">TAG</span>, e<span class="pl-k">.</span>getMessage(), e);
       }
   }
}</pre></div>

<p>To see your new Web and Mobile Analytics, open the Web and Mobile Analytics app within the Marketing Cloud and agree to the Terms and Conditions to get started.</p>

<p><img src="imgReadMe/image_30.png" alt="image alt text"></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/salesforce-marketingcloud/LearningAppAndroid">Learning App Android</a> is maintained by <a href="https://github.com/salesforce-marketingcloud">salesforce-marketingcloud</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
